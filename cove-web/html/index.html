<!doctype html>
<html lang="zh">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/uppy/uppy.min.css">
    <script type="text/javascript"
            src="http://webapi.amap.com/maps?v=1.4.14&key=6b87d1d3817e5b1c59b8a646300c4b25"></script>
    <title>发现世界</title>
</head>

<body>
<header>
    <nav class="navbar navbar-expand-md navbar-dark color-bg-first">
        <a class="navbar-brand" href="#">
            <img src="/static/img/logo_40_40.png"/>发现世界
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse"
                aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">首页 <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">附近</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">发现</a>
                </li>
            </ul>
            <ul class="navbar-nav right">
                <li class="nav-item">
                    <a class="nav-link" href="#">上传</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">我的</a>
                </li>
            </ul>
        </div>
    </nav>
</header>

<main role="main">
    <div id="container"></div>
</main>

<div class="mark">
    <div class="card-body" id="upload">
    </div>
</div>

<script src="/static/http/fetch.js" type="module"></script>
<script src="/static/vue/vue.js"></script>
<script src="/static/uppy/uppy.min.js"></script>
<script src="/static/uppy/uppy.zh_CN.min.js"></script>
<script src="/static/uppy/exif.js"></script>

<script>
        AMap.plugin('AMap.ToolBar', function() {
            var toolbar = new AMap.ToolBar();
            map.addControl(toolbar)
        });
        AMap.plugin('AMap.Geolocation', function() {
            geolocation = new AMap.Geolocation({
                enableHighAccuracy: true,
                timeout: 10000,
                showMarker: false,
                showCircle: false,
            });
            geolocation.getCurrentPosition();
            AMap.event.addListener(geolocation, 'complete', function(result) {
                console.log('定位成功');
                map.center(result.position);
            });
            AMap.event.addListener(geolocation, 'error', function(result) {
                console.log('定位失败');
            });
        });

        var map = new AMap.Map('container', {
            resizeEnable: true,
            zoom: 11,
        });


        var marker2 = new AMap.Marker({
            icon: '/static/img/img2.png',
            map: map,
            title: '天津塘沽金箍棒',
            position: new AMap.LngLat(117.7044081688, 39.0223511513)
        });



        var mrkContent3 = '<div class="marker"><img class="orange" src="/static/img/img3.png" /></div>';
        var marker3 = new AMap.Marker({
            content: mrkContent3,
            map: map,
            title: '国家海洋博物馆',
            position: new AMap.LngLat(117.7947235107, 39.1066201166),
        });
        // 信息窗体的内容
        var infoContent3 = [
            '<div><img src="/static/img/img3.png">',
            '<div><b>国家海洋博物馆</b>',
            '中国天津市天津市滨海新区荣盛路</div></div>'
        ];
        // 创建 infoWindow 实例	
        var infoWindow3 = new AMap.InfoWindow({
            content: infoContent3.join("<br>"),
            anchor: 'bottom-center',
            offset: new AMap.Pixel(12, -24)
        });
        marker3.on('click', function() {
            console.log('marker click')
            infoWindow3.open(map, [117.7947235107, 39.1066201166]);
        });

        var content4 = '<div class="marker"><img class="yellow" src="/static/img/img4.png" /></div>';
        var marker4 = new AMap.Marker({
            content: content4,
            map: map,
            title: '遗鸥公园',
            position: new AMap.LngLat(117.7877283096, 39.1365182243)
        });
        var content5 = '<div class="marker"><img class="green" src="/static/img/img5.png" /></div>';
        var marker5 = new AMap.Marker({
            content: content5,
            map: map,
            title: '妈祖文化园',
            position: new AMap.LngLat(117.8444623947, 39.1079854504)
        });

var uppy = Uppy.Core({
    debug: true,
    autoProceed: false,
    restrictions: {
        maxFileSize: 10000000,
        maxNumberOfFiles: 10,
        allowedFileTypes: ['image/*']
    },
    locale: Uppy.locales.zh_CN,
    onBeforeUpload:(files) => {
        console.log('准备上传!');
        const updatedFiles = Object.assign({}, files)
        Object.keys(updatedFiles).forEach(fileId => {
            // 获取文件
            EXIF.getData(updatedFiles[fileId].preview, function() {
                var make = EXIF.getTag(this, "Make");
                var model = EXIF.getTag(this, "Model");
            });

            console.log(updatedFiles[fileId].name);
        })
    return updatedFiles;
}
})
.use(Uppy.Dashboard, {
    inline: true,
    target: '#upload',
    replaceTargetContent: true,
    showProgressDetails: true,
    note: '只允许上传图片, 最多10个文件，最大10M',
    height: 470,
    metaFields: [{
        id: 'name',
        name: '名称',
        placeholder: '文件名称'
    }],
    browserBackButtonClose: true
})
.use(Uppy.XHRUpload, {
    fieldName:'file',
    endpoint: 'http://localhost:8088/story/cute'
});

uppy.on("complete", (result) => {
    console.log('上传完成!');
});



</script>

</body>

</html>